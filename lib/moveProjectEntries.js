"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = moveProjectEntries;
var _fsExtra = require("fs-extra");
var _necessary = require("necessary");
var _pathMaps = require("./utilities/pathMaps");
var _constants = require("./constants");
var concatenatePaths = _necessary.pathUtilities.concatenatePaths, checkEntryExists = _necessary.fileSystemUtilities.checkEntryExists, isEntryDirectory = _necessary.fileSystemUtilities.isEntryDirectory, isDirectoryEmpty = _necessary.fileSystemUtilities.isDirectoryEmpty;
function moveProjectEntries(projectsDirectoryPath, json, callback) {
    var pathMaps = json.pathMaps, targetPaths = [];
    (0, _pathMaps).asynchronousForEach(pathMaps, function(sourcePath, targetPath, directory, next, done, index) {
        moveEntry(sourcePath, targetPath, projectsDirectoryPath, function(targetPath) {
            targetPaths.push(targetPath);
            next();
        });
    }, function() {
        var json = targetPaths; ///
        callback(json);
    });
}
function moveEntry(sourcePath, targetPath, projectsDirectoryPath, callback) {
    if (targetPath === null) {
        callback(targetPath);
    } else {
        if (sourcePath === targetPath) {
            callback(targetPath);
        } else {
            var absoluteSourcePath = concatenatePaths(projectsDirectoryPath, sourcePath), entryExists = checkEntryExists(absoluteSourcePath);
            if (!entryExists) {
                targetPath = null;
                callback(targetPath);
            } else {
                var entryDirectory = isEntryDirectory(absoluteSourcePath);
                entryDirectory ? moveDirectory(sourcePath, targetPath, projectsDirectoryPath, callback) : moveFile(sourcePath, targetPath, projectsDirectoryPath, callback);
            }
        }
    }
}
function moveFile(sourcePath, targetPath, projectsDirectoryPath, callback) {
    var absoluteSourcePath = concatenatePaths(projectsDirectoryPath, sourcePath), absoluteTargetPath = concatenatePaths(projectsDirectoryPath, targetPath);
    (0, _fsExtra).move(absoluteSourcePath, absoluteTargetPath, function(error) {
        var success = !error; ///
        targetPath = success ? targetPath : sourcePath;
        callback(targetPath);
    });
}
function moveDirectory(sourcePath, targetPath, projectsDirectoryPath, callback) {
    var absoluteSourcePath = concatenatePaths(projectsDirectoryPath, sourcePath), absoluteTargetPath = concatenatePaths(projectsDirectoryPath, targetPath), directoryEmpty = isDirectoryEmpty(absoluteSourcePath);
    if (!directoryEmpty) {
        var targetPath = sourcePath;
        callback(targetPath);
    } else {
        (0, _fsExtra).move(absoluteSourcePath, absoluteTargetPath, function(error) {
            var success = !error; ///
            if (success) {
                callback(targetPath);
            } else {
                var message = error.message;
                if (message !== _constants.DEST_ALREADY_EXISTS_MESSAGE) {
                    var targetPath = sourcePath;
                    callback(targetPath);
                } else {
                    (0, _fsExtra).remove(absoluteSourcePath, function(error) {
                        var success = !error; ///
                        if (!success) {
                            targetPath = sourcePath;
                        }
                        callback(targetPath);
                    });
                }
            }
        });
    }
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb3ZlUHJvamVjdEVudHJpZXMuanMiXSwibmFtZXMiOlsibW92ZSIsInJlbW92ZSIsInBhdGhVdGlsaXRpZXMiLCJmaWxlU3lzdGVtVXRpbGl0aWVzIiwiYXN5bmNocm9ub3VzRm9yRWFjaCIsIkRFU1RfQUxSRUFEWV9FWElTVFNfTUVTU0FHRSIsImNvbmNhdGVuYXRlUGF0aHMiLCJjaGVja0VudHJ5RXhpc3RzIiwiaXNFbnRyeURpcmVjdG9yeSIsImlzRGlyZWN0b3J5RW1wdHkiLCJtb3ZlUHJvamVjdEVudHJpZXMiLCJwcm9qZWN0c0RpcmVjdG9yeVBhdGgiLCJqc29uIiwiY2FsbGJhY2siLCJwYXRoTWFwcyIsInRhcmdldFBhdGhzIiwic291cmNlUGF0aCIsInRhcmdldFBhdGgiLCJkaXJlY3RvcnkiLCJuZXh0IiwiZG9uZSIsImluZGV4IiwibW92ZUVudHJ5IiwicHVzaCIsImFic29sdXRlU291cmNlUGF0aCIsImVudHJ5RXhpc3RzIiwiZW50cnlEaXJlY3RvcnkiLCJtb3ZlRGlyZWN0b3J5IiwibW92ZUZpbGUiLCJhYnNvbHV0ZVRhcmdldFBhdGgiLCJlcnJvciIsInN1Y2Nlc3MiLCJkaXJlY3RvcnlFbXB0eSIsIm1lc3NhZ2UiXSwibWFwcGluZ3MiOiJDQUFBLFVBQVk7Ozs7a0JBV1ksa0JBQWtCO0FBVGIsR0FBVSxDQUFWLFFBQVU7QUFDWSxHQUFXLENBQVgsVUFBVztBQUUxQixHQUFzQixDQUF0QixTQUFzQjtBQUNkLEdBQWEsQ0FBYixVQUFhO0FBRXpELEdBQUssQ0FBRyxnQkFBZ0IsR0FMMkIsVUFBVyxlQUt0RCxnQkFBZ0IsRUFDaEIsZ0JBQWdCLEdBTjJCLFVBQVcscUJBTXRELGdCQUFnQixFQUFFLGdCQUFnQixHQU5TLFVBQVcscUJBTXBDLGdCQUFnQixFQUFFLGdCQUFnQixHQU5ULFVBQVcscUJBTWxCLGdCQUFnQjtTQUVwQyxrQkFBa0IsQ0FBQyxxQkFBcUIsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUM7SUFDakYs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QUFDLE9BQU8sSUFBSSxLQUFLLENBQUUsQ0FBRyxBQUFILEVBQUcsQUFBSCxDQUFHO1lBRTNCLEVBQUUsRUFBRSxPQUFPLEVBQUUsQ0FBQztnQkFDWixRQUFRLENBQUMsVUFBVTtZQUNyQixDQUFDLE1BQU0sQ0FBQztnQkFDTixHQUFLLENBQUcsT0FBTyxHQUFLLEtBQUssQ0FBakIsT0FBTztnQkFFZixFQUFFLEVBQUUsT0FBTyxLQXBGeUIsVUFBYSw4QkFvRkosQ0FBQztvQkFDNUMsR0FBSyxDQUFDLFVBQVUsR0FBRyxVQUFVO29CQUU3QixRQUFRLENBQUMsVUFBVTtnQkFDckIsQ0FBQyxNQUFNLENBQUM7d0JBNUZhLFFBQVUsU0E2RnRCLGtCQUFrQixFQUFFLFFBQVEsQ0FBUCxLQUFLLEVBQUssQ0FBQzt3QkFDckMsR0FBSyxDQUFDLE9BQU8sSUFBSSxLQUFLLENBQUUsQ0FBRyxBQUFILEVBQUcsQUFBSCxDQUFHO3dCQUUzQixFQUFFLEdBQUcsT0FBTyxFQUFFLENBQUM7NEJBQ2IsVUFBVSxHQUFHLFVBQVU7d0JBQ3pCLENBQUM7d0JBRUQsUUFBUSxDQUFDLFVBQVU7b0JBQ3JCLENBQUM7Z0JBQ0gsQ0FBQztZQUNILENBQUM7UUFDSCxDQUFDO0lBQ0gsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IHsgbW92ZSwgcmVtb3ZlIH0gZnJvbSBcImZzLWV4dHJhXCI7XG5pbXBvcnQgeyBwYXRoVXRpbGl0aWVzLCBmaWxlU3lzdGVtVXRpbGl0aWVzIH0gZnJvbSBcIm5lY2Vzc2FyeVwiO1xuXG5pbXBvcnQgeyBhc3luY2hyb25vdXNGb3JFYWNoIH0gZnJvbSBcIi4vdXRpbGl0aWVzL3BhdGhNYXBzXCI7XG5pbXBvcnQgeyBERVNUX0FMUkVBRFlfRVhJU1RTX01FU1NBR0UgfSBmcm9tIFwiLi9jb25zdGFudHNcIjtcblxuY29uc3QgeyBjb25jYXRlbmF0ZVBhdGhzIH0gPSBwYXRoVXRpbGl0aWVzLFxuICAgICAgeyBjaGVja0VudHJ5RXhpc3RzLCBpc0VudHJ5RGlyZWN0b3J5LCBpc0RpcmVjdG9yeUVtcHR5IH0gPSBmaWxlU3lzdGVtVXRpbGl0aWVzO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBtb3ZlUHJvamVjdEVudHJpZXMocHJvamVjdHNEaXJlY3RvcnlQYXRoLCBqc29uLCBjYWxsYmFjaykge1xuICBjb25zdCB7IHBhdGhNYXBzIH0gPSBqc29uLFxuXHRcdCAgICB0YXJnZXRQYXRocyA9IFtdO1xuXG4gIGFzeW5jaHJvbm91c0ZvckVhY2goXG4gICAgcGF0aE1hcHMsXG4gICAgKHNvdXJjZVBhdGgsIHRhcmdldFBhdGgsIGRpcmVjdG9yeSwgbmV4dCwgZG9uZSwgaW5kZXgpID0+IHtcbiAgICAgIG1vdmVFbnRyeShzb3VyY2VQYXRoLCB0YXJnZXRQYXRoLCBwcm9qZWN0c0RpcmVjdG9yeVBhdGgsICh0YXJnZXRQYXRoKSA9PiB7XG4gICAgICAgIHRhcmdldFBhdGhzLnB1c2godGFyZ2V0UGF0aCk7XG5cbiAgICAgICAgbmV4dCgpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICAoKSA9PiB7XG4gICAgXHRjb25zdCBqc29uID0gdGFyZ2V0UGF0aHM7IC8vL1xuXG4gICAgICBjYWxsYmFjayhqc29uKTtcbiAgICB9XG4gICk7XG59XG5cbmZ1bmN0aW9uIG1vdmVFbnRyeShzb3VyY2VQYXRoLCB0YXJnZXRQYXRoLCBwcm9qZWN0c0RpcmVjdG9yeVBhdGgsIGNhbGxiYWNrKSB7XG4gIGlmICh0YXJnZXRQYXRoID09PSBudWxsKSB7XG4gICAgY2FsbGJhY2sodGFyZ2V0UGF0aCk7XG4gIH0gZWxzZSB7XG4gICAgaWYgKHNvdXJjZVBhdGggPT09IHRhcmdldFBhdGgpIHtcbiAgICAgIGNhbGxiYWNrKHRhcmdldFBhdGgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBhYnNvbHV0ZVNvdXJjZVBhdGggPSBjb25jYXRlbmF0ZVBhdGhzKHByb2plY3RzRGlyZWN0b3J5UGF0aCwgc291cmNlUGF0aCksXG4gICAgICAgICAgICBlbnRyeUV4aXN0cyA9IGNoZWNrRW50cnlFeGlzdHMoYWJzb2x1dGVTb3VyY2VQYXRoKTtcblxuICAgICAgaWYgKCFlbnRyeUV4aXN0cykge1xuICAgICAgICB0YXJnZXRQYXRoID0gbnVsbDtcblxuICAgICAgICBjYWxsYmFjayh0YXJnZXRQYXRoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGVudHJ5RGlyZWN0b3J5ID0gaXNFbnRyeURpcmVjdG9yeShhYnNvbHV0ZVNvdXJjZVBhdGgpO1xuXG4gICAgICAgIGVudHJ5RGlyZWN0b3J5ID9cbiAgICAgICAgICBtb3ZlRGlyZWN0b3J5KHNvdXJjZVBhdGgsIHRhcmdldFBhdGgsIHByb2plY3RzRGlyZWN0b3J5UGF0aCwgY2FsbGJhY2spIDpcbiAgICAgICAgICAgIG1vdmVGaWxlKHNvdXJjZVBhdGgsIHRhcmdldFBhdGgsIHByb2plY3RzRGlyZWN0b3J5UGF0aCwgY2FsbGJhY2spO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBtb3ZlRmlsZShzb3VyY2VQYXRoLCB0YXJnZXRQYXRoLCBwcm9qZWN0c0RpcmVjdG9yeVBhdGgsIGNhbGxiYWNrKSB7XG4gIGNvbnN0IGFic29sdXRlU291cmNlUGF0aCA9IGNvbmNhdGVuYXRlUGF0aHMocHJvamVjdHNEaXJlY3RvcnlQYXRoLCBzb3VyY2VQYXRoKSxcbiAgICAgICAgYWJzb2x1dGVUYXJnZXRQYXRoID0gY29uY2F0ZW5hdGVQYXRocyhwcm9qZWN0c0RpcmVjdG9yeVBhdGgsIHRhcmdldFBhdGgpO1xuXG4gIG1vdmUoYWJzb2x1dGVTb3VyY2VQYXRoLCBhYnNvbHV0ZVRhcmdldFBhdGgsIChlcnJvcikgPT4ge1xuICAgIGNvbnN0IHN1Y2Nlc3MgPSAhZXJyb3I7IC8vL1xuICAgIFxuICAgIHRhcmdldFBhdGggPSBzdWNjZXNzID9cbiAgICAgICAgICAgICAgICAgICB0YXJnZXRQYXRoIDpcbiAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVBhdGg7XG5cbiAgICBjYWxsYmFjayh0YXJnZXRQYXRoKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIG1vdmVEaXJlY3Rvcnkoc291cmNlUGF0aCwgdGFyZ2V0UGF0aCwgcHJvamVjdHNEaXJlY3RvcnlQYXRoLCBjYWxsYmFjaykge1xuICBjb25zdCBhYnNvbHV0ZVNvdXJjZVBhdGggPSBjb25jYXRlbmF0ZVBhdGhzKHByb2plY3RzRGlyZWN0b3J5UGF0aCwgc291cmNlUGF0aCksXG4gICAgICAgIGFic29sdXRlVGFyZ2V0UGF0aCA9IGNvbmNhdGVuYXRlUGF0aHMocHJvamVjdHNEaXJlY3RvcnlQYXRoLCB0YXJnZXRQYXRoKSxcbiAgICAgICAgZGlyZWN0b3J5RW1wdHkgPSBpc0RpcmVjdG9yeUVtcHR5KGFic29sdXRlU291cmNlUGF0aCk7XG5cbiAgaWYgKCFkaXJlY3RvcnlFbXB0eSkge1xuICAgIGNvbnN0IHRhcmdldFBhdGggPSBzb3VyY2VQYXRoO1xuXG4gICAgY2FsbGJhY2sodGFyZ2V0UGF0aCk7XG4gIH0gZWxzZSB7XG4gICAgbW92ZShhYnNvbHV0ZVNvdXJjZVBhdGgsIGFic29sdXRlVGFyZ2V0UGF0aCwgKGVycm9yKSA9PiB7XG4gICAgICBjb25zdCBzdWNjZXNzID0gIWVycm9yOyAvLy9cblxuICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgY2FsbGJhY2sodGFyZ2V0UGF0aCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCB7IG1lc3NhZ2UgfSA9IGVycm9yO1xuXG4gICAgICAgIGlmIChtZXNzYWdlICE9PSBERVNUX0FMUkVBRFlfRVhJU1RTX01FU1NBR0UpIHtcbiAgICAgICAgICBjb25zdCB0YXJnZXRQYXRoID0gc291cmNlUGF0aDtcblxuICAgICAgICAgIGNhbGxiYWNrKHRhcmdldFBhdGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlbW92ZShhYnNvbHV0ZVNvdXJjZVBhdGgsIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3VjY2VzcyA9ICFlcnJvcjsgLy8vXG5cbiAgICAgICAgICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgICAgICAgICB0YXJnZXRQYXRoID0gc291cmNlUGF0aDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2FsbGJhY2sodGFyZ2V0UGF0aCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIl19