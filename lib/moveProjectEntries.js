"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = moveProjectEntries;
exports.moveEntry = moveEntry;
var _fsExtra = require("fs-extra");
var _necessary = require("necessary");
var _removeProjectEntries = require("./removeProjectEntries");
var _pathMaps = require("./utilities/pathMaps");
var concatenatePaths = _necessary.pathUtilities.concatenatePaths, checkEntryExists = _necessary.fileSystemUtilities.checkEntryExists, isEntryDirectory = _necessary.fileSystemUtilities.isEntryDirectory, isDirectoryEmpty = _necessary.fileSystemUtilities.isDirectoryEmpty;
function moveProjectEntries(projectsDirectoryPath, json, callback) {
    var pathMaps = json.pathMaps, sourceEntryPaths = [], targetEntryPaths = [];
    (0, _pathMaps).asynchronousForEach(pathMaps, function(sourceEntryPath, targetEntryPath, entryDirectory, next, done, index) {
        moveEntry(sourceEntryPath, targetEntryPath, projectsDirectoryPath, function(sourceEntryPath, targetEntryPath) {
            sourceEntryPaths.push(sourceEntryPath);
            targetEntryPaths.push(targetEntryPath);
            next();
        });
    }, function() {
        var json = {
            sourceEntryPaths: sourceEntryPaths,
            targetEntryPaths: targetEntryPaths
        };
        callback(json);
    });
}
function moveEntry(sourceEntryPath, targetEntryPath, projectsDirectoryPath, callback) {
    if (targetEntryPath === null) {
        (0, _removeProjectEntries).removeEntry(sourceEntryPath, targetEntryPath, projectsDirectoryPath, callback);
        return;
    }
    if (sourceEntryPath === targetEntryPath) {
        callback(sourceEntryPath, targetEntryPath);
        return;
    }
    var absoluteSourceEntryPath = concatenatePaths(projectsDirectoryPath, sourceEntryPath), sourceEntryExists = checkEntryExists(absoluteSourceEntryPath), entryDirectory = isEntryDirectory(absoluteSourceEntryPath);
    if (!sourceEntryExists) {
        var targetEntryPath = null;
        callback(sourceEntryPath, targetEntryPath);
        return;
    }
    entryDirectory ? moveDirectory(sourceEntryPath, targetEntryPath, projectsDirectoryPath, callback) : moveFile(sourceEntryPath, targetEntryPath, projectsDirectoryPath, callback);
}
function moveFile(sourceEntryPath, targetEntryPath, projectsDirectoryPath, callback) {
    var sourceFilePath = sourceEntryPath, targetFilePath = targetEntryPath, absoluteSourceFilePath = concatenatePaths(projectsDirectoryPath, sourceFilePath), absoluteTargetFilePath = concatenatePaths(projectsDirectoryPath, targetFilePath), targetFileExists = checkEntryExists(absoluteTargetFilePath);
    if (targetFileExists) {
        var sourceEntryPath = null;
        callback(sourceEntryPath, targetEntryPath);
        return;
    }
    (0, _fsExtra).move(absoluteSourceFilePath, absoluteTargetFilePath, function(error) {
        if (error) {
            var sourceEntryPath = null;
            callback(sourceEntryPath, targetEntryPath);
            return;
        }
        callback(sourceEntryPath, targetEntryPath);
    });
}
function moveDirectory(sourceEntryPath, targetEntryPath, projectsDirectoryPath, callback) {
    var sourceDirectoryPath = sourceEntryPath, targetDirectoryPath = targetEntryPath, absoluteSourceDirectoryPath = concatenatePaths(projectsDirectoryPath, sourceDirectoryPath), absoluteTargetDirectoryPath = concatenatePaths(projectsDirectoryPath, targetDirectoryPath), targetDirectoryExists = checkEntryExists(absoluteTargetDirectoryPath), directoryEmpty = isDirectoryEmpty(absoluteSourceDirectoryPath);
    if (!directoryEmpty) {
        var sourceEntryPath = null;
        callback(sourceEntryPath, targetEntryPath);
        return;
    }
    if (targetDirectoryExists) {
        (0, _fsExtra).remove(absoluteSourceDirectoryPath, function(error) {
            if (error) {
                var sourceEntryPath = null;
                callback(sourceEntryPath, targetEntryPath);
                return;
            }
            callback(sourceEntryPath, targetEntryPath);
        });
        return;
    }
    (0, _fsExtra).move(absoluteSourceDirectoryPath, absoluteTargetDirectoryPath, function(error) {
        if (error) {
            var sourceEntryPath = null;
            callback(sourceEntryPath, targetEntryPath);
            return;
        }
        callback(sourceEntryPath, targetEntryPath);
    });
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb3ZlUHJvamVjdEVudHJpZXMuanMiXSwibmFtZXMiOlsibW92ZSIsInJlbW92ZSIsInBhdGhVdGlsaXRpZXMiLCJmaWxlU3lzdGVtVXRpbGl0aWVzIiwicmVtb3ZlRW50cnkiLCJhc3luY2hyb25vdXNGb3JFYWNoIiwiY29uY2F0ZW5hdGVQYXRocyIsImNoZWNrRW50cnlFeGlzdHMiLCJpc0VudHJ5RGlyZWN0b3J5IiwiaXNEaXJlY3RvcnlFbXB0eSIsIm1vdmVQcm9qZWN0RW50cmllcyIsInByb2plY3RzRGlyZWN0b3J5UGF0aCIsImpzb24iLCJjYWxsYmFjayIsInBhdGhNYXBzIiwic291cmNlRW50cnlQYXRocyIsInRhcmdldEVudHJ5UGF0aHMiLCJzb3VyY2VFbnRyeVBhdGgiLCJ0YXJnZXRFbnRyeVBhdGgiLCJlbnRyeURpcmVjdG9yeSIsIm5leHQiLCJkb25lIiwiaW5kZXgiLCJtb3ZlRW50cnkiLCJwdXNoIiwiYWJzb2x1dGVTb3VyY2VFbnRyeVBhdGgiLCJzb3VyY2VFbnRyeUV4aXN0cyIsIm1vdmVEaXJlY3RvcnkiLCJtb3ZlRmlsZSIsInNvdXJjZUZpbGVQYXRoIiwidGFyZ2V0RmlsZVBhdGgiLCJhYnNvbHV0ZVNvdXJjZUZpbGVQYXRoIiwiYWJzb2x1dGVUYXJnZXRGaWxlUGF0aCIsInRhcmdldEZpbGVFeGlzdHMiLCJlcnJvciIsInNvdXJjZURpcmVjdG9yeVBhdGgiLCJ0YXJnZXREaXJlY3RvcnlQYXRoIiwiYWJzb2x1dGVTb3VyY2VEaXJlY3RvcnlQYXRoIiwiYWJzb2x1dGVUYXJnZXREaXJlY3RvcnlQYXRoIiwidGFyZ2V0RGlyZWN0b3J5RXhpc3RzIiwiZGlyZWN0b3J5RW1wdHkiXSwibWFwcGluZ3MiOiJBQUFBLENBQVk7Ozs7a0JBV1ksa0JBQWtCO1FBMEIxQixTQUFTLEdBQVQsU0FBUztBQW5DSSxHQUFVLENBQVYsUUFBVTtBQUNZLEdBQVcsQ0FBWCxVQUFXO0FBRWxDLEdBQXdCLENBQXhCLHFCQUF3QjtBQUNoQixH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LEVBQUUsUUFBUSxDQUFQLEtBQUssRUFBSyxDQUFDO1FBQ3pFLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQztZQUNWLEdBQUssQ0FBQyxlQUFlLEdBQUcsSUFBSTtZQUU1QixRQUFRLENBQUMsZUFBZSxFQUFFLGVBQWU7WUFFekMsTUFBTTtRQUNSLENBQUM7UUFFRCxRQUFRLENBQUMsZUFBZSxFQUFFLGVBQWU7SUFDM0MsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IHsgbW92ZSwgcmVtb3ZlIH0gZnJvbSBcImZzLWV4dHJhXCI7XG5pbXBvcnQgeyBwYXRoVXRpbGl0aWVzLCBmaWxlU3lzdGVtVXRpbGl0aWVzIH0gZnJvbSBcIm5lY2Vzc2FyeVwiO1xuXG5pbXBvcnQgeyByZW1vdmVFbnRyeSB9IGZyb20gXCIuL3JlbW92ZVByb2plY3RFbnRyaWVzXCI7XG5pbXBvcnQgeyBhc3luY2hyb25vdXNGb3JFYWNoIH0gZnJvbSBcIi4vdXRpbGl0aWVzL3BhdGhNYXBzXCI7XG5cbmNvbnN0IHsgY29uY2F0ZW5hdGVQYXRocyB9ID0gcGF0aFV0aWxpdGllcyxcbiAgICAgIHsgY2hlY2tFbnRyeUV4aXN0cywgaXNFbnRyeURpcmVjdG9yeSwgaXNEaXJlY3RvcnlFbXB0eSB9ID0gZmlsZVN5c3RlbVV0aWxpdGllcztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gbW92ZVByb2plY3RFbnRyaWVzKHByb2plY3RzRGlyZWN0b3J5UGF0aCwganNvbiwgY2FsbGJhY2spIHtcbiAgY29uc3QgeyBwYXRoTWFwcyB9ID0ganNvbixcbiAgICAgICAgc291cmNlRW50cnlQYXRocyA9IFtdLFxuXHRcdCAgICB0YXJnZXRFbnRyeVBhdGhzID0gW107XG5cbiAgYXN5bmNocm9ub3VzRm9yRWFjaChcbiAgICBwYXRoTWFwcyxcbiAgICAoc291cmNlRW50cnlQYXRoLCB0YXJnZXRFbnRyeVBhdGgsIGVudHJ5RGlyZWN0b3J5LCBuZXh0LCBkb25lLCBpbmRleCkgPT4ge1xuICAgICAgbW92ZUVudHJ5KHNvdXJjZUVudHJ5UGF0aCwgdGFyZ2V0RW50cnlQYXRoLCBwcm9qZWN0c0RpcmVjdG9yeVBhdGgsIChzb3VyY2VFbnRyeVBhdGgsIHRhcmdldEVudHJ5UGF0aCkgPT4ge1xuICAgICAgICBzb3VyY2VFbnRyeVBhdGhzLnB1c2goc291cmNlRW50cnlQYXRoKTtcbiAgICAgICAgdGFyZ2V0RW50cnlQYXRocy5wdXNoKHRhcmdldEVudHJ5UGF0aCk7XG5cbiAgICAgICAgbmV4dCgpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICAoKSA9PiB7XG4gICAgXHRjb25zdCBqc29uID0ge1xuICAgICAgICBzb3VyY2VFbnRyeVBhdGhzLFxuICAgICAgICB0YXJnZXRFbnRyeVBhdGhzXG4gICAgICB9O1xuXG4gICAgICBjYWxsYmFjayhqc29uKTtcbiAgICB9XG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtb3ZlRW50cnkoc291cmNlRW50cnlQYXRoLCB0YXJnZXRFbnRyeVBhdGgsIHByb2plY3RzRGlyZWN0b3J5UGF0aCwgY2FsbGJhY2spIHtcbiAgaWYgKHRhcmdldEVudHJ5UGF0aCA9PT0gbnVsbCkge1xuICAgIHJlbW92ZUVudHJ5KHNvdXJjZUVudHJ5UGF0aCwgdGFyZ2V0RW50cnlQYXRoLCBwcm9qZWN0c0RpcmVjdG9yeVBhdGgsIGNhbGxiYWNrKTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChzb3VyY2VFbnRyeVBhdGggPT09IHRhcmdldEVudHJ5UGF0aCkge1xuICAgIGNhbGxiYWNrKHNvdXJjZUVudHJ5UGF0aCwgdGFyZ2V0RW50cnlQYXRoKTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGFic29sdXRlU291cmNlRW50cnlQYXRoID0gY29uY2F0ZW5hdGVQYXRocyhwcm9qZWN0c0RpcmVjdG9yeVBhdGgsIHNvdXJjZUVudHJ5UGF0aCksXG4gICAgICAgIHNvdXJjZUVudHJ5RXhpc3RzID0gY2hlY2tFbnRyeUV4aXN0cyhhYnNvbHV0ZVNvdXJjZUVudHJ5UGF0aCksXG4gICAgICAgIGVudHJ5RGlyZWN0b3J5ID0gaXNFbnRyeURpcmVjdG9yeShhYnNvbHV0ZVNvdXJjZUVudHJ5UGF0aCk7XG5cbiAgaWYgKCFzb3VyY2VFbnRyeUV4aXN0cykge1xuICAgIGNvbnN0IHRhcmdldEVudHJ5UGF0aCA9IG51bGw7XG5cbiAgICBjYWxsYmFjayhzb3VyY2VFbnRyeVBhdGgsIHRhcmdldEVudHJ5UGF0aCk7XG5cbiAgICByZXR1cm47XG4gIH1cblxuICBlbnRyeURpcmVjdG9yeSA/XG4gICAgbW92ZURpcmVjdG9yeShzb3VyY2VFbnRyeVBhdGgsIHRhcmdldEVudHJ5UGF0aCwgcHJvamVjdHNEaXJlY3RvcnlQYXRoLCBjYWxsYmFjaykgOlxuICAgICAgbW92ZUZpbGUoc291cmNlRW50cnlQYXRoLCB0YXJnZXRFbnRyeVBhdGgsIHByb2plY3RzRGlyZWN0b3J5UGF0aCwgY2FsbGJhY2spO1xufVxuXG5mdW5jdGlvbiBtb3ZlRmlsZShzb3VyY2VFbnRyeVBhdGgsIHRhcmdldEVudHJ5UGF0aCwgcHJvamVjdHNEaXJlY3RvcnlQYXRoLCBjYWxsYmFjaykge1xuICBjb25zdCBzb3VyY2VGaWxlUGF0aCA9IHNvdXJjZUVudHJ5UGF0aCwgIC8vL1xuICAgICAgICB0YXJnZXRGaWxlUGF0aCA9IHRhcmdldEVudHJ5UGF0aCwgIC8vL1xuICAgICAgICBhYnNvbHV0ZVNvdXJjZUZpbGVQYXRoID0gY29uY2F0ZW5hdGVQYXRocyhwcm9qZWN0c0RpcmVjdG9yeVBhdGgsIHNvdXJjZUZpbGVQYXRoKSxcbiAgICAgICAgYWJzb2x1dGVUYXJnZXRGaWxlUGF0aCA9IGNvbmNhdGVuYXRlUGF0aHMocHJvamVjdHNEaXJlY3RvcnlQYXRoLCB0YXJnZXRGaWxlUGF0aCksXG4gICAgICAgIHRhcmdldEZpbGVFeGlzdHMgPSBjaGVja0VudHJ5RXhpc3RzKGFic29sdXRlVGFyZ2V0RmlsZVBhdGgpO1xuXG4gIGlmICh0YXJnZXRGaWxlRXhpc3RzKSB7XG4gICAgY29uc3Qgc291cmNlRW50cnlQYXRoID0gbnVsbDtcblxuICAgIGNhbGxiYWNrKHNvdXJjZUVudHJ5UGF0aCwgdGFyZ2V0RW50cnlQYXRoKTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIG1vdmUoYWJzb2x1dGVTb3VyY2VGaWxlUGF0aCwgYWJzb2x1dGVUYXJnZXRGaWxlUGF0aCwgKGVycm9yKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zdCBzb3VyY2VFbnRyeVBhdGggPSBudWxsO1xuXG4gICAgICBjYWxsYmFjayhzb3VyY2VFbnRyeVBhdGgsIHRhcmdldEVudHJ5UGF0aCk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhzb3VyY2VFbnRyeVBhdGgsIHRhcmdldEVudHJ5UGF0aCk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBtb3ZlRGlyZWN0b3J5KHNvdXJjZUVudHJ5UGF0aCwgdGFyZ2V0RW50cnlQYXRoLCBwcm9qZWN0c0RpcmVjdG9yeVBhdGgsIGNhbGxiYWNrKSB7XG4gIGNvbnN0IHNvdXJjZURpcmVjdG9yeVBhdGggPSBzb3VyY2VFbnRyeVBhdGgsIC8vL1xuICAgICAgICB0YXJnZXREaXJlY3RvcnlQYXRoID0gdGFyZ2V0RW50cnlQYXRoLCAvL1xuICAgICAgICBhYnNvbHV0ZVNvdXJjZURpcmVjdG9yeVBhdGggPSBjb25jYXRlbmF0ZVBhdGhzKHByb2plY3RzRGlyZWN0b3J5UGF0aCwgc291cmNlRGlyZWN0b3J5UGF0aCksXG4gICAgICAgIGFic29sdXRlVGFyZ2V0RGlyZWN0b3J5UGF0aCA9IGNvbmNhdGVuYXRlUGF0aHMocHJvamVjdHNEaXJlY3RvcnlQYXRoLCB0YXJnZXREaXJlY3RvcnlQYXRoKSxcbiAgICAgICAgdGFyZ2V0RGlyZWN0b3J5RXhpc3RzID0gY2hlY2tFbnRyeUV4aXN0cyhhYnNvbHV0ZVRhcmdldERpcmVjdG9yeVBhdGgpLFxuICAgICAgICBkaXJlY3RvcnlFbXB0eSA9IGlzRGlyZWN0b3J5RW1wdHkoYWJzb2x1dGVTb3VyY2VEaXJlY3RvcnlQYXRoKTtcblxuICBpZiAoIWRpcmVjdG9yeUVtcHR5KSB7XG4gICAgY29uc3Qgc291cmNlRW50cnlQYXRoID0gbnVsbDtcblxuICAgIGNhbGxiYWNrKHNvdXJjZUVudHJ5UGF0aCwgdGFyZ2V0RW50cnlQYXRoKTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICh0YXJnZXREaXJlY3RvcnlFeGlzdHMpIHtcbiAgICByZW1vdmUoYWJzb2x1dGVTb3VyY2VEaXJlY3RvcnlQYXRoLCAoZXJyb3IpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zdCBzb3VyY2VFbnRyeVBhdGggPSBudWxsO1xuXG4gICAgICAgIGNhbGxiYWNrKHNvdXJjZUVudHJ5UGF0aCwgdGFyZ2V0RW50cnlQYXRoKTtcblxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNhbGxiYWNrKHNvdXJjZUVudHJ5UGF0aCwgdGFyZ2V0RW50cnlQYXRoKTtcbiAgICB9KTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIG1vdmUoYWJzb2x1dGVTb3VyY2VEaXJlY3RvcnlQYXRoLCBhYnNvbHV0ZVRhcmdldERpcmVjdG9yeVBhdGgsIChlcnJvcikgPT4ge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc3Qgc291cmNlRW50cnlQYXRoID0gbnVsbDtcblxuICAgICAgY2FsbGJhY2soc291cmNlRW50cnlQYXRoLCB0YXJnZXRFbnRyeVBhdGgpO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY2FsbGJhY2soc291cmNlRW50cnlQYXRoLCB0YXJnZXRFbnRyeVBhdGgpO1xuICB9KTtcbn1cbiJdfQ==